# Crackme walthroughs

## Table of Contents

- [Crackme walthroughs](#crackme-walthroughs)
  - [Table of Contents](#table-of-contents)
  - [Static analysis](#static-analysis)
  - [Behavioral analysis](#behavioral-analysis)
  - [Dynamic analysis](#dynamic-analysis)
  - [Another crackme](#another-crackme)

## Static analysis

When file is downloaded it comes with **zip** extension (crackme.zip).

When I tried extracting it, 7zip extracted files that looked like executable sections.

Indeed inspecting it in *Detect it easy (DIE)* it shows that it is in PE format.

Changing extension from **zip** to **exe** do the trick.

The file is ready for an analysis.

Inspecting the file in *PEstudio* yield following results:

<!-- TODO
PEstudio analysis -->

## Behavioral analysis

*Regshot* didn't find anything important.

I have launched *wireshark*, and *fakedns* on Remnux machine to simulate network, but there was no activity.

There was only a cmd waiting for input.

## Dynamic analysis

I have launched *IDA* and *x64dbg* to inspect the disassembly of the program.

Since there was no strings I started searching for them, becouse they could be encoded or encrypted.

Before the ***ConsoleWriteA*** function, there was a function that was decrypting the strings.

It took 3 argumets:

- key
- offset
- ciphertext

Encryption works the same as decryption (it's the same function). First letter (as ascii ordinal) is XORed with the **key**, second letter is XORed with the **key + offset**.

I have managed to write [python script](decodestring.py) that decrypts any string encrypted like that

After giving input to the program there was a password check, which was just checking sums of different letters. I've written system of equations to satisfy the check:

- 6 + 7 = 205
- 5 + 8 = 201
- 3 = 109 [m]
- 4 + 9 = 166
- 0 + 1 = 194

String ***d^0mBddied*** worked, but that was not the correct password.

The program had also antidebugging capability.

It measured time since start of the computer with funciton *GetTickCount*. Then it compared the difference of these values with some hardcoded value.

Debugging takes a long time so the difference was bigger than the value. When run normally it was less than the value.

To bypass this protection I only needed to set breakpoint after the second *GetTickCount* function.

After giving the password, the program had another check. Fortunately it gave another condition for the password.

Now it looks like this:

- 6 + 7 = 205
- 5 + 8 = 201
- 3 = 109 [m]
- 4 + 9 = 166
- 0 + 1 = 194
- 2 = 48 [0]
- 8 = 85 [U]
- 5 = 116 [t]
- 0 = 80 [P]
- 1 = 114 [r]
- 4 + 6 + 9 - 7 = 169
- 6 - 7 = 3
- 6 = 104 [h]
- 7 = 101 [e]

This system of equations has only one solution which yields the correct password ***Pr0m3theUs***.

But program says it is not the correct prompt and I had to look further.

I noticed that on the start of the program there was a condition that was checking if the program itself was named Cr4ckm3.exe. I have changed the name and now the prompt gave me URL to another crackeme challange.

## Another crackme
